---
//Import relevant dependencies
import ThemeIcon from "@components/ThemeIcon.astro";
import NavLink from "@components/ui/links/NavLink.astro";
import Authentication from "../misc/Authentication.astro";
import enStrings from "@utils/navigation.ts";
import frStrings from "@utils/fr/navigation.ts";
import LanguagePicker from "@components/ui/LanguagePicker.astro";

// Select the correct translation based on the page's lang prop:
const strings = Astro.currentLocale === "fr" ? frStrings : enStrings;
const homeUrl = Astro.currentLocale === "fr" ? "/fr" : "/";

// Icons for nav items - clean SVG icons
const navIcons: Record<string, string> = {
  "Home": '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>',
  "Mission": '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><circle cx="12" cy="12" r="6"></circle><circle cx="12" cy="12" r="2"></circle></svg>',
  "Rules": '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="9" y1="15" x2="15" y2="15"></line><line x1="9" y1="11" x2="15" y2="11"></line></svg>',
  "Prizes": '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"></path><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"></path><path d="M4 22h16"></path><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"></path><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"></path><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"></path></svg>',
  "Sponsors": '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"></polygon></svg>',
  "Timeline": '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>',
  "Docs": '<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"></path><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"></path></svg>',
};
---

<!-- Main header component -->
<header
  class="navbar-header sticky inset-x-0 top-0 z-50 flex w-full flex-wrap text-sm md:flex-nowrap md:justify-start"
>
  <!-- Glassmorphism background -->
  <div class="navbar-glass absolute inset-0 backdrop-blur-md bg-neutral-900/80 border-b border-neutral-700/50"></div>

  <!-- Navigation container -->
  <nav
    class="relative mx-auto w-full max-w-7xl px-4 py-3 md:flex md:items-center md:justify-between md:px-6 lg:px-8"
    aria-label="Global"
  >
    <div class="flex items-center justify-between">
      <!-- Brand logo with glow effect -->
      <a
        class="group flex items-center gap-3 rounded-xl outline-hidden ring-orange-500/50 focus-visible:ring-2 transition-all duration-200"
        href={homeUrl}
        aria-label="VibeCodeUtah"
      >
        <div class="relative">
          <div class="absolute inset-0 bg-gradient-to-r from-orange-500/20 to-yellow-500/20 blur-xl rounded-full group-hover:from-orange-500/40 group-hover:to-yellow-500/40 transition-all duration-500"></div>
          <img
            src="/vcu-logo.png"
            alt="VibeCodeUtah"
            class="relative h-14 w-14 object-contain drop-shadow-lg group-hover:scale-110 transition-transform duration-200"
          />
        </div>
        <div class="flex flex-col">
          <span class="text-lg font-bold bg-gradient-to-r from-orange-400 to-yellow-400 bg-clip-text text-transparent">
            VibeCode
          </span>
          <span class="text-[10px] font-semibold text-neutral-400 tracking-widest uppercase -mt-1">
            Utah 2025
          </span>
        </div>
      </a>

      <!-- Mobile controls -->
      <div class="flex items-center gap-2 md:hidden">
        <!-- Theme toggle for mobile -->
        <ThemeIcon />
        <!-- Collapse toggle for smaller screens -->
        <button
          type="button"
          class="hs-collapse-toggle flex h-10 w-10 items-center justify-center rounded-xl text-sm font-bold text-neutral-400 transition duration-200 hover:bg-neutral-800 hover:text-orange-400 disabled:pointer-events-none disabled:opacity-50"
          data-hs-collapse="#navbar-collapse-with-animation"
          aria-controls="navbar-collapse-with-animation"
          aria-label="Toggle navigation"
        >
          <svg
            class="h-5 w-5 shrink-0 hs-collapse-open:hidden"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <line x1="3" x2="21" y1="6" y2="6"></line>
            <line x1="3" x2="21" y1="12" y2="12"></line>
            <line x1="3" x2="21" y1="18" y2="18"></line>
          </svg>
          <svg
            class="hidden h-5 w-5 shrink-0 hs-collapse-open:block"
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
          >
            <path d="M18 6 6 18"></path>
            <path d="m6 6 12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Contains navigation links -->
    <div
      id="navbar-collapse-with-animation"
      class="hs-collapse hidden grow basis-full overflow-hidden transition-all duration-300 md:block"
    >
      <!-- Navigation links container -->
      <div
        class="mt-5 flex flex-col gap-1 md:mt-0 md:flex-row md:items-center md:justify-end md:gap-1"
      >
        <!-- Navigation links with enhanced styling -->
        {strings.navBarLinks.map((link) => (
          <a
            id={link.url === "/" ? "home" : link.url.replace("/", "")}
            href={link.url}
            data-astro-prefetch
            class="nav-link group relative flex items-center gap-2 rounded-xl px-3 py-2.5 text-sm font-medium text-neutral-300 outline-hidden transition-all duration-200 hover:text-orange-400 md:px-3 md:py-2"
          >
            <span class="nav-icon opacity-60 group-hover:opacity-100 group-hover:scale-110 transition-all duration-200" set:html={navIcons[link.name] || "â€¢"} />
            <span class="relative">
              {link.name}
              <span class="nav-underline absolute -bottom-0.5 left-0 h-0.5 w-0 bg-gradient-to-r from-orange-400 to-yellow-400 transition-all duration-200 ease-out group-hover:w-full"></span>
            </span>
          </a>
        ))}

        <!-- Separator -->
        <div class="hidden md:block h-6 w-px bg-neutral-700 mx-2"></div>

        <!-- Right side controls -->
        <div class="flex items-center gap-2 mt-4 md:mt-0">
          <Authentication />
          <LanguagePicker />
          <!-- ThemeIcon for larger screens -->
          <span class="hidden md:inline-block">
            <ThemeIcon />
          </span>

          <!-- CTA Register Button -->
          <a
            href="/#register"
            class="register-btn relative inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-orange-500 to-yellow-500 px-4 py-2 text-sm font-semibold text-neutral-900 shadow-lg shadow-orange-500/20 transition-all duration-200 hover:shadow-xl hover:shadow-orange-500/30 hover:scale-[1.02] hover:-translate-y-0.5"
          >
            <svg class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            <span>Join Now</span>
          </a>
        </div>
      </div>
    </div>
  </nav>
</header>

<style>
  .navbar-header {
    animation: slideDown 0.5s ease-out;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .nav-link.active {
    color: rgb(251 146 60); /* orange-400 */
  }

  .nav-link.active .nav-underline {
    width: 100%;
  }

  .nav-link.active .nav-icon {
    opacity: 1;
  }

  /* Pulse animation for register button */
  .register-btn::before {
    content: '';
    position: absolute;
    inset: -2px;
    border-radius: 14px;
    background: linear-gradient(to right, rgb(249 115 22), rgb(234 179 8));
    opacity: 0;
    animation: pulse-glow 2s ease-in-out infinite;
    z-index: -1;
  }

  @keyframes pulse-glow {
    0%, 100% {
      opacity: 0;
      transform: scale(1);
    }
    50% {
      opacity: 0.3;
      transform: scale(1.05);
    }
  }

  /* Mobile nav styling */
  @media (max-width: 767px) {
    .nav-link {
      border-radius: 0.75rem;
      padding: 0.75rem 1rem;
    }

    .nav-link:hover {
      background: rgba(251, 146, 60, 0.1);
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    let url = window.location.pathname;
    let hash = window.location.hash;

    // Handle hash-based navigation for section links
    const fullPath = url + hash;

    document.querySelectorAll('.nav-link').forEach((link) => {
      const href = link.getAttribute('href');
      if (href === fullPath || href === url || (href === '/' && url === '/')) {
        link.classList.add('active');
        link.setAttribute('aria-current', 'page');
      }
    });

    // Update active state on hash change
    window.addEventListener('hashchange', () => {
      const newHash = window.location.hash;
      document.querySelectorAll('.nav-link').forEach((link) => {
        link.classList.remove('active');
        link.removeAttribute('aria-current');
        const href = link.getAttribute('href');
        if (href === '/#' + newHash.slice(1) || href === newHash) {
          link.classList.add('active');
          link.setAttribute('aria-current', 'page');
        }
      });
    });
  });
</script>
<!-- Theme Appearance script to manage light/dark modes -->
<script is:inline>
  const HSThemeAppearance = {
    init() {
      const defaultTheme = "default";
      let theme = localStorage.getItem("hs_theme") || defaultTheme;

      if (document.querySelector("html").classList.contains("dark")) return;
      this.setAppearance(theme);
    },
    _resetStylesOnLoad() {
      const $resetStyles = document.createElement("style");
      $resetStyles.innerText = `*{transition: unset !important;}`;
      $resetStyles.setAttribute("data-hs-appearance-onload-styles", "");
      document.head.appendChild($resetStyles);
      return $resetStyles;
    },
    setAppearance(theme, saveInStore = true, dispatchEvent = true) {
      const $resetStylesEl = this._resetStylesOnLoad();

      if (saveInStore) {
        localStorage.setItem("hs_theme", theme);
      }

      if (theme === "auto") {
        theme = window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "default";
      }

      document.querySelector("html").classList.remove("dark");
      document.querySelector("html").classList.remove("default");
      document.querySelector("html").classList.remove("auto");

      document
        .querySelector("html")
        .classList.add(this.getOriginalAppearance());

      setTimeout(() => {
        $resetStylesEl.remove();
      });

      if (dispatchEvent) {
        window.dispatchEvent(
          new CustomEvent("on-hs-appearance-change", { detail: theme }),
        );
      }
    },
    getAppearance() {
      let theme = this.getOriginalAppearance();
      if (theme === "auto") {
        theme = window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "default";
      }
      return theme;
    },
    getOriginalAppearance() {
      const defaultTheme = "default";
      return localStorage.getItem("hs_theme") || defaultTheme;
    },
  };
  HSThemeAppearance.init();

  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", () => {
      if (HSThemeAppearance.getOriginalAppearance() === "auto") {
        HSThemeAppearance.setAppearance("auto", false);
      }
    });

  window.addEventListener("load", () => {
    const $clickableThemes = document.querySelectorAll(
      "[data-hs-theme-click-value]",
    );
    const $switchableThemes = document.querySelectorAll(
      "[data-hs-theme-switch]",
    );

    $clickableThemes.forEach(($item) => {
      $item.addEventListener("click", () =>
        HSThemeAppearance.setAppearance(
          $item.getAttribute("data-hs-theme-click-value"),
          true,
          $item,
        ),
      );
    });

    $switchableThemes.forEach(($item) => {
      $item.addEventListener("change", (e) => {
        HSThemeAppearance.setAppearance(e.target.checked ? "dark" : "default");
      });

      $item.checked = HSThemeAppearance.getAppearance() === "dark";
    });

    window.addEventListener("on-hs-appearance-change", (e) => {
      $switchableThemes.forEach(($item) => {
        $item.checked = e.detail === "dark";
      });
    });
  });
</script>
