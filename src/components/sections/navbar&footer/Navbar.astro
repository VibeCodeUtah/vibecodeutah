---
//Import relevant dependencies
import ThemeIcon from "@components/ThemeIcon.astro";
import NavLink from "@components/ui/links/NavLink.astro";
import Authentication from "../misc/Authentication.astro";
import enStrings from "@utils/navigation.ts";
import frStrings from "@utils/fr/navigation.ts";
import LanguagePicker from "@components/ui/LanguagePicker.astro";

// Select the correct translation based on the page's lang prop:
const strings = Astro.currentLocale === "fr" ? frStrings : enStrings;
const homeUrl = Astro.currentLocale === "fr" ? "/fr" : "/";
---

<!-- Modern Floating Navbar -->
<header class="navbar-header fixed inset-x-0 top-0 z-50 px-4 pt-4">
  <nav
    class="navbar-container mx-auto max-w-7xl rounded-2xl border border-neutral-200 dark:border-neutral-700 bg-white dark:bg-neutral-900 backdrop-blur-xl shadow-lg dark:shadow-2xl shadow-neutral-200/50 dark:shadow-black/20"
    aria-label="Global"
  >
    <div class="flex items-center justify-between px-4 py-3 lg:px-6">
      <!-- Logo -->
      <a
        class="group flex items-center gap-3 outline-none"
        href={homeUrl}
        aria-label="VibeCodeUtah"
      >
        <div class="relative">
          <div class="logo-glow absolute inset-0 bg-gradient-to-r from-cyan-500/30 via-purple-500/30 to-orange-500/30 blur-xl rounded-full opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
          <!-- Light mode: show dark logo -->
          <img
            src="/vcu-logo-light.png"
            alt="VibeCodeUtah"
            class="relative h-10 w-10 object-contain transition-transform duration-300 group-hover:scale-110 dark:hidden"
          />
          <!-- Dark mode: show light logo -->
          <img
            src="/vcu-logo-dark.png"
            alt="VibeCodeUtah"
            class="relative h-10 w-10 object-contain transition-transform duration-300 group-hover:scale-110 hidden dark:block"
          />
        </div>
        <div class="hidden sm:flex flex-col">
          <span class="text-base font-bold text-neutral-900 dark:text-white tracking-tight">
            VibeCode<span class="text-transparent bg-clip-text bg-gradient-to-r from-cyan-500 via-purple-500 to-orange-500 dark:from-cyan-400 dark:via-purple-400 dark:to-orange-400">Utah</span>
          </span>
          <span class="text-[10px] font-medium text-neutral-500 tracking-widest uppercase">
            Hackathon 2026
          </span>
        </div>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center">
        <!-- Nav Pills Container -->
        <div class="nav-pills flex items-center gap-0.5 rounded-xl bg-neutral-100 dark:bg-white/10 p-1">
          {strings.navBarLinks.map((link) => (
            <a
              data-nav-target={link.url === "/" ? "home" : link.url.replace("/", "").replace("#", "")}
              href={link.url.includes('#') ? link.url.replace('/#', '#') : link.url}
              data-astro-prefetch={link.url.includes('#') ? undefined : true}
              class="nav-pill relative px-3 py-2 text-sm font-semibold text-neutral-700 dark:text-neutral-200 rounded-lg transition-all duration-300 hover:text-neutral-900 dark:hover:text-white whitespace-nowrap"
            >
              <span class="relative z-10">{link.name}</span>
              <div class="nav-pill-bg absolute inset-0 rounded-lg bg-gradient-to-r from-cyan-500/10 via-purple-500/10 to-orange-500/10 dark:from-cyan-500/30 dark:via-purple-500/30 dark:to-orange-500/30 opacity-0 transition-opacity duration-300 pointer-events-none"></div>
            </a>
          ))}
        </div>
      </div>

      <!-- Right Side Actions -->
      <div class="flex items-center gap-3">
        <!-- Desktop utilities -->
        <div class="hidden md:flex items-center gap-2">
          <Authentication />
          <LanguagePicker />
          <ThemeIcon />
        </div>

        <!-- CTA Button - Animated gradient border -->
        <a
          href="/#register"
          class="cta-button group relative overflow-hidden rounded-xl px-5 py-2.5 text-sm font-bold transition-all duration-300"
        >
          <!-- Animated gradient background -->
          <div class="absolute inset-0 bg-gradient-to-r from-cyan-500 via-purple-500 to-orange-500 transition-transform duration-500 group-hover:scale-105"></div>
          <!-- Shimmer effect -->
          <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white/20 to-transparent -translate-x-full group-hover:translate-x-full transition-transform duration-700"></div>
          <!-- Button content -->
          <span class="relative z-10 flex items-center gap-2 text-white">
            <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M13 10V3L4 14h7v7l9-11h-7z" />
            </svg>
            Join Now
          </span>
        </a>

        <!-- Mobile Menu Button -->
        <button
          type="button"
          class="mobile-menu-btn lg:hidden flex h-10 w-10 items-center justify-center rounded-xl bg-neutral-100 dark:bg-white/5 text-neutral-600 dark:text-neutral-400 transition-all duration-300 hover:bg-neutral-200 dark:hover:bg-white/10 hover:text-neutral-900 dark:hover:text-white"
          data-hs-collapse="#navbar-collapse-with-animation"
          aria-controls="navbar-collapse-with-animation"
          aria-label="Toggle navigation"
        >
          <svg class="menu-icon h-5 w-5 transition-transform duration-300" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <line x1="4" x2="20" y1="6" y2="6"></line>
            <line x1="4" x2="20" y1="12" y2="12"></line>
            <line x1="4" x2="20" y1="18" y2="18"></line>
          </svg>
          <svg class="close-icon hidden h-5 w-5" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M18 6 6 18"></path>
            <path d="m6 6 12 12"></path>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Navigation -->
    <div
      id="navbar-collapse-with-animation"
      class="hidden overflow-hidden transition-all duration-300 lg:hidden"
    >
      <div class="border-t border-neutral-200 dark:border-white/10 px-4 py-4">
        <div class="flex flex-col gap-2">
          {strings.navBarLinks.map((link) => (
            <a
              href={link.url.includes('#') ? link.url.replace('/#', '#') : link.url}
              data-astro-prefetch={link.url.includes('#') ? undefined : true}
              class="mobile-nav-link flex items-center gap-3 rounded-xl px-4 py-3 text-neutral-800 dark:text-neutral-100 transition-all duration-300 hover:bg-neutral-100 dark:hover:bg-white/10 hover:text-neutral-900 dark:hover:text-white"
            >
              <span class="font-semibold">{link.name}</span>
            </a>
          ))}

          <!-- Mobile utilities -->
          <div class="flex items-center gap-3 mt-4 pt-4 border-t border-neutral-200 dark:border-white/10">
            <Authentication />
            <LanguagePicker />
            <ThemeIcon />
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>

<!-- Spacer to prevent content from going under fixed navbar -->
<div class="h-24"></div>

<style>
  .navbar-header {
    animation: navSlideDown 0.6s cubic-bezier(0.16, 1, 0.3, 1);
  }

  @keyframes navSlideDown {
    from {
      opacity: 0;
      transform: translateY(-100%);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Active state for nav pills */
  .nav-pill.active {
    color: var(--tw-text-opacity, 1);
  }

  :global(.dark) .nav-pill.active {
    color: white;
  }

  :global(:not(.dark)) .nav-pill.active {
    color: rgb(23 23 23);
  }

  .nav-pill.active .nav-pill-bg {
    opacity: 1;
  }

  .nav-pill:hover .nav-pill-bg {
    opacity: 1;
  }

  /* Animated border glow for CTA */
  .cta-button {
    box-shadow:
      0 0 20px rgba(168, 85, 247, 0.3),
      0 0 40px rgba(168, 85, 247, 0.1);
  }

  .cta-button:hover {
    box-shadow:
      0 0 30px rgba(168, 85, 247, 0.5),
      0 0 60px rgba(168, 85, 247, 0.2);
  }

  /* Mobile nav link hover state */
  .mobile-nav-link.active {
    background: rgba(0, 0, 0, 0.05);
  }

  :global(.dark) .mobile-nav-link.active {
    background: rgba(255, 255, 255, 0.05);
    color: white;
  }

  .mobile-nav-link.active::before {
    content: '';
    position: absolute;
    left: 0;
    top: 50%;
    transform: translateY(-50%);
    width: 3px;
    height: 60%;
    background: linear-gradient(to bottom, #06b6d4, #a855f7, #f97316);
    border-radius: 0 4px 4px 0;
  }

  /* Menu button animation */
  .mobile-menu-btn[aria-expanded="true"] .menu-icon {
    display: none;
  }

  .mobile-menu-btn[aria-expanded="true"] .close-icon {
    display: block;
  }

  /* Responsive adjustments */
  @media (max-width: 1023px) {
    .navbar-header {
      padding-top: 0.75rem;
      padding-left: 0.75rem;
      padding-right: 0.75rem;
    }
  }

  /* Scroll shadow effect */
  .navbar-header.scrolled .navbar-container {
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
  }

  :global(.dark) .navbar-header.scrolled .navbar-container {
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    let url = window.location.pathname;
    let hash = window.location.hash;

    // Set active state for nav pills
    document.querySelectorAll('.nav-pill, .mobile-nav-link').forEach((link) => {
      const href = link.getAttribute('href');
      if (href === hash || (href === '/' && url === '/' && !hash)) {
        link.classList.add('active');
        link.setAttribute('aria-current', 'page');
      }
    });

    // Add scroll shadow
    const header = document.querySelector('.navbar-header');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 20) {
        header?.classList.add('scrolled');
      } else {
        header?.classList.remove('scrolled');
      }
    });

    // Hash change handler
    window.addEventListener('hashchange', () => {
      const newHash = window.location.hash;
      document.querySelectorAll('.nav-pill, .mobile-nav-link').forEach((link) => {
        link.classList.remove('active');
        link.removeAttribute('aria-current');
        const href = link.getAttribute('href');
        if (href === newHash) {
          link.classList.add('active');
          link.setAttribute('aria-current', 'page');
        }
      });
    });

    // Mobile menu toggle - vanilla JS fallback for Preline
    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
    const mobileMenu = document.getElementById('navbar-collapse-with-animation');

    if (mobileMenuBtn && mobileMenu) {
      mobileMenuBtn.addEventListener('click', () => {
        const isOpen = !mobileMenu.classList.contains('hidden');

        if (isOpen) {
          // Close menu
          mobileMenu.classList.add('hidden');
          mobileMenuBtn.setAttribute('aria-expanded', 'false');
          mobileMenuBtn.querySelector('.menu-icon')?.classList.remove('hidden');
          mobileMenuBtn.querySelector('.close-icon')?.classList.add('hidden');
        } else {
          // Open menu
          mobileMenu.classList.remove('hidden');
          mobileMenuBtn.setAttribute('aria-expanded', 'true');
          mobileMenuBtn.querySelector('.menu-icon')?.classList.add('hidden');
          mobileMenuBtn.querySelector('.close-icon')?.classList.remove('hidden');
        }
      });

      // Close menu when clicking a link
      mobileMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          mobileMenu.classList.add('hidden');
          mobileMenuBtn.setAttribute('aria-expanded', 'false');
          mobileMenuBtn.querySelector('.menu-icon')?.classList.remove('hidden');
          mobileMenuBtn.querySelector('.close-icon')?.classList.add('hidden');
        });
      });
    }
  });
</script>

<!-- Theme Appearance script to manage light/dark modes -->
<script is:inline>
  const HSThemeAppearance = {
    init() {
      const defaultTheme = "default";
      let theme = localStorage.getItem("hs_theme") || defaultTheme;

      if (document.querySelector("html").classList.contains("dark")) return;
      this.setAppearance(theme);
    },
    _resetStylesOnLoad() {
      const $resetStyles = document.createElement("style");
      $resetStyles.innerText = `*{transition: unset !important;}`;
      $resetStyles.setAttribute("data-hs-appearance-onload-styles", "");
      document.head.appendChild($resetStyles);
      return $resetStyles;
    },
    setAppearance(theme, saveInStore = true, dispatchEvent = true) {
      const $resetStylesEl = this._resetStylesOnLoad();

      if (saveInStore) {
        localStorage.setItem("hs_theme", theme);
      }

      if (theme === "auto") {
        theme = window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "default";
      }

      document.querySelector("html").classList.remove("dark");
      document.querySelector("html").classList.remove("default");
      document.querySelector("html").classList.remove("auto");

      document
        .querySelector("html")
        .classList.add(this.getOriginalAppearance());

      setTimeout(() => {
        $resetStylesEl.remove();
      });

      if (dispatchEvent) {
        window.dispatchEvent(
          new CustomEvent("on-hs-appearance-change", { detail: theme }),
        );
      }
    },
    getAppearance() {
      let theme = this.getOriginalAppearance();
      if (theme === "auto") {
        theme = window.matchMedia("(prefers-color-scheme: dark)").matches
          ? "dark"
          : "default";
      }
      return theme;
    },
    getOriginalAppearance() {
      const defaultTheme = "default";
      return localStorage.getItem("hs_theme") || defaultTheme;
    },
  };
  HSThemeAppearance.init();

  window
    .matchMedia("(prefers-color-scheme: dark)")
    .addEventListener("change", () => {
      if (HSThemeAppearance.getOriginalAppearance() === "auto") {
        HSThemeAppearance.setAppearance("auto", false);
      }
    });

  window.addEventListener("load", () => {
    const $clickableThemes = document.querySelectorAll(
      "[data-hs-theme-click-value]",
    );
    const $switchableThemes = document.querySelectorAll(
      "[data-hs-theme-switch]",
    );

    $clickableThemes.forEach(($item) => {
      $item.addEventListener("click", () =>
        HSThemeAppearance.setAppearance(
          $item.getAttribute("data-hs-theme-click-value"),
          true,
          $item,
        ),
      );
    });

    $switchableThemes.forEach(($item) => {
      $item.addEventListener("change", (e) => {
        HSThemeAppearance.setAppearance(e.target.checked ? "dark" : "default");
      });

      $item.checked = HSThemeAppearance.getAppearance() === "dark";
    });

    window.addEventListener("on-hs-appearance-change", (e) => {
      $switchableThemes.forEach(($item) => {
        $item.checked = e.detail === "dark";
      });
    });
  });
</script>
